___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Form Abandonment Tracking",
  "categories": [
    "UTILITY"
  ],
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "The template pushes a \"form_abandonment\" event right before a user leaves the page",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "event_name",
    "displayName": "DataLayer Event Name",
    "simpleValueType": true,
    "help": "Specify a dataLayer event name to be pushed when an abandoned form is detected",
    "valueHint": "e.g. form_abandoned",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "STRING_LENGTH",
        "args": [
          2,
          30
        ]
      }
    ]
  },
  {
    "type": "LABEL",
    "name": "Trigger hint",
    "displayName": "* use \"Initialization - All Pages\" trigger with this template for best results"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const logToConsole = require('logToConsole');
const injectScript = require('injectScript');
const copyFromWindow = require('copyFromWindow');
const setInWindow = require('setInWindow');
const queryPermission = require('queryPermission');

//const log = data.debug ? logToConsole : (() => {});
const event_name = data.event_name;
setInWindow('fat_event_name', event_name);

const url = 'https://cdn.jsdelivr.net/gh/lbvigo/count_dl_event_var/form_abandonment.js';
if (queryPermission('inject_script', url)) {
  injectScript(url, data.gtmOnSuccess, data.gtmOnFailure, url);
}
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "fat_event_name"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.jsdelivr.net/gh/lbvigo/count_dl_event_var/form_abandonment.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 9/5/2024, 7:28:15 PM


