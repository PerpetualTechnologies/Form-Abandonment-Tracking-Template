___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Perpetual Form Abandonment Tracking",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "The template pushes a \"form_abandonment\" event right before a user leaves the page",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "event_name",
    "displayName": "DataLayer Event Name",
    "simpleValueType": true,
    "help": "Specify a dataLayer event name to be pushed when an abandoned form is detected",
    "valueHint": "e.g. form_abandoned",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "type": "STRING_LENGTH",
        "args": [
          2,
          30
        ]
      }
    ]
  },
  {
    "type": "LABEL",
    "name": "Trigger hint",
    "displayName": "* use \"Initialization - All Pages\" trigger with this template for best results"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const logToConsole = require('logToConsole');
const injectScript = require('injectScript');
const copyFromWindow = require('copyFromWindow');
const setInWindow = require('setInWindow');
const queryPermission = require('queryPermission');

//const log = data.debug ? logToConsole : (() => {});
const event_name = data.event_name;
setInWindow('fat_event_name', event_name);

const url = 'https://cdn.jsdelivr.net/gh/PerpetualTechnologies/formabandonment/form_abandonment.js';
if (queryPermission('inject_script', url)) {
  injectScript(url, data.gtmOnSuccess, data.gtmOnFailure, url);
}
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "fat_event_name"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.jsdelivr.net/gh/PerpetualTechnologies/formabandonment/form_abandonment.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 9/5/2024, 7:28:15 PM


